<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.back.mapper.MannerMapper">
    <!-- 매너 목록 -->
    <select id="getManner" parameterType="String" resultType="com.sist.back.vo.ReviewListVO">
      SELECT MIN(r.reviewlistkey) AS reviewlistkey, MIN(r.preference) AS preference, r.review,
            COUNT(CASE WHEN r.preference = 0 THEN 1 END) + COUNT(CASE WHEN r.preference IN (1, 2) THEN 1 END) AS count
      FROM manner m
      JOIN reviewlist r ON m.reviewlistkey = r.reviewlistkey
      WHERE m.userkey = #{userkey}
      GROUP BY r.review
      ORDER BY MIN(r.reviewlistkey)
  </select>
</mapper>